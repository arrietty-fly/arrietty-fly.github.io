class Player{constructor(){return Player.instance?Player.instance:this.getInstance(...arguments)}getInstance(){let i=new PlayerCreator(...arguments);return Player.instance=i,i}}class Musics{constructor(){this.songs=[{id:1,title:"乱春",singer:"Plave-YEJUN",songUrl:"https://link.jscdn.cn/1drv/aHR0cHM6Ly8xZHJ2Lm1zL3UvcyFBa3h5TDcxY0FlT2lobjNqVXF4c0hmNnYtR1JEP2U9VHVuTEp5.mp3",imageUrl:"https://www.hualigs.cn/image/6477327b406c2.jpg"},{id:2,title:"Love Poem",singer:"IU",songUrl:"https://link.jscdn.cn/1drv/aHR0cHM6Ly8xZHJ2Lm1zL3UvcyFBa3h5TDcxY0FlT2lod09WV28yZ1JTZHRHMXBNP2U9SWV2UmJR.mp3",imageUrl:"https://www.hualigs.cn/image/6477327aa8f7c.jpg"},{id:3,title:"在我心中(Seed)",singer:"TAEYANG",songUrl:"https://link.jscdn.cn/1drv/aHR0cHM6Ly8xZHJ2Lm1zL3UvcyFBa3h5TDcxY0FlT2lod0RXbzBCUXhaTXdRZ2lMP2U9ZXVkWXJP.mp3",imageUrl:"https://www.hualigs.cn/image/64773baadbbdd.jpg"},{id:4,title:"Camelia",singer:"Mili",songUrl:"https://link.jscdn.cn/1drv/aHR0cHM6Ly8xZHJ2Lm1zL3UvcyFBa3h5TDcxY0FlT2lod0p4T1gwREN3N3Bkb2loP2U9eTIzZk5N.mp3",imageUrl:"https://www.hualigs.cn/image/64773c01e471d.jpg"},{id:5,title:"LilaS",singer:"SawanoHiroyuki[nZk] (泽野弘之)/たかはしほのか",songUrl:"https://link.jscdn.cn/1drv/aHR0cHM6Ly8xZHJ2Lm1zL3UvcyFBa3h5TDcxY0FlT2lod1JrV1pWaDVvUGNTMHJyP2U9V2VmVEpq.mp3",imageUrl:"https://www.hualigs.cn/image/6477327b82e33.jpg"},{id:6,title:"飘落的花瓣(Fallin’ Flower)",singer:"SEVENTEEN",songUrl:"https://link.jscdn.cn/1drv/aHR0cHM6Ly8xZHJ2Lm1zL3UvcyFBa3h5TDcxY0FlT2lod0gtWTU3WVJKc00tZmZHP2U9OElSV1Vv.mp3",imageUrl:"https://www.hualigs.cn/image/64773d1c4e097.jpg"},{id:7,title:"HWAA",singer:"(G)I-DLE",songUrl:"https://link.jscdn.cn/1drv/aHR0cHM6Ly8xZHJ2Lm1zL3UvcyFBa3h5TDcxY0FlT2lobjhIQU1qcmNqTjdEbV9TP2U9NHFadGty.mp3",imageUrl:"https://www.hualigs.cn/image/6477327ad2abf.jpg"},{id:8,title:"春はゆく(春逝)",singer:"Aimer",songUrl:"https://link.jscdn.cn/1drv/aHR0cHM6Ly8xZHJ2Lm1zL3UvcyFBa3h5TDcxY0FlT2lod2F5bmZ3QlpDVkRKeWdLP2U9eTluYTcz.mp3",imageUrl:"https://www.hualigs.cn/image/6477327bb17e2.jpg"}]}getSongByNum(i){return this.songs[i]}}class PlayerCreator{constructor(){this.audio=document.querySelector(".music-player__audio"),this.audio.volume=.8,this.util=new Util,this.musics=new Musics,this.song_index=0,this.loop_mode=0,this.song_list=$(".music__list_content"),this.render_doms={title:$(".music__info--title"),singer:$(".music__info--singer"),image:$(".music-player__image img"),blur:$(".music-player__blur")},this.ban_dom={control__btn:$(".control__volume--icon")},this.render_time={now:$(".nowTime"),total:$(".totalTime")},this.disc={image:$(".music-player__image"),pointer:$(".music-player__pointer")},this.init()}init(){this.renderSongList(),this.renderSongStyle(),this.bindEventListener()}renderSongList(){let i="";this.musics.songs.forEach(((t,s)=>{i+=`<li class="music__list__item">${t.title}</li>`})),this.song_list.html(i)}renderSongStyle(){let{title:i,singer:t,songUrl:s,imageUrl:e}=this.musics.getSongByNum(this.song_index);this.audio.src=s,this.render_doms.title.html(i),this.render_doms.singer.html(t),this.render_doms.image.prop("src",e),this.render_doms.blur.css("background-image",'url("'+e+'")'),this.song_list.find(".music__list__item").eq(this.song_index).addClass("play").siblings().removeClass("play")}bindEventListener(){this.$play=new Btns(".player-control__btn--play",{click:this.handlePlayAndPause.bind(this)}),this.$prev=new Btns(".player-control__btn--prev",{click:this.changeSong.bind(this,"prev")}),this.$next=new Btns(".player-control__btn--next",{click:this.changeSong.bind(this,"next")}),this.$mode=new Btns(".player-control__btn--mode",{click:this.changePlayMode.bind(this)}),this.$ban=new Btns(".control__volume--icon",{click:this.banNotes.bind(this)}),this.song_list.on("click","li",(i=>{let t=$(i.target).index();this.changeSong(t)})),new Progress(".control__volume--progress",{min:0,max:1,value:this.audio.volume,handler:i=>{this.audio.volume=i}}),this.audio.oncanplay=()=>{if(this.progress)return this.progress.max=this.audio.duration,this.render_time.total.html(this.util.formatTime(this.audio.duration)),!1;this.progress=new Progress(".player__song--progress",{min:0,max:this.audio.duration,value:0,handler:i=>{this.audio.currentTime=i}}),this.render_time.total.html(this.util.formatTime(this.audio.duration))},this.audio.ontimeupdate=()=>{this.progress.setValue(this.audio.currentTime),this.render_time.now.html(this.util.formatTime(this.audio.currentTime))},this.audio.onended=()=>{this.changeSong("next"),this.audio.play()}}handlePlayAndPause(){let i=this.$play.$el.find("i");this.audio.paused?(this.audio.play(),i.removeClass("icon-play").addClass("icon-pause"),this.disc.image.addClass("play"),this.disc.pointer.addClass("play")):(this.audio.pause(),i.addClass("icon-play").removeClass("icon-pause"),this.disc.image.removeClass("play"),this.disc.pointer.removeClass("play"))}changePlayMode(){this.loop_mode++,this.loop_mode>2&&(this.loop_mode=0),this.renderPlayMode()}renderPlayMode(){this.$mode.$el.find("i").prop("class","iconfont icon-"+["loop","random","single"][this.loop_mode])}changeSongIndex(i){if("number"==typeof i)this.song_index=i;else if(0===this.loop_mode)this.song_index+="next"===i?1:-1,this.song_index>this.musics.songs.length-1&&(this.song_index=0),this.song_index<0&&(this.song_index=this.musics.songs.length-1);else if(1===this.loop_mode){let i=this.musics.songs.length,t=Math.floor(Math.random()*i);for(let s=0;s<1e4;s++){if(this.song_index!=t){this.song_index=t;break}t=Math.floor(Math.random()*i)}}else 2===this.loop_mode&&(this.song_index=this.song_index)}songTime(){let i=parseInt(this.audio.duration/60)<10?"0"+parseInt(this.audio.duration/60):parseInt(this.audio.duration/60),t=parseInt(this.audio.duration%60)<10?"0"+parseInt(this.audio.duration%60):parseInt(this.audio.duration%60);$(".totalTime").text(i+":"+t)}changeSong(i){this.changeSongIndex(i);let t=this.audio.paused;this.renderSongStyle(),t||this.audio.play()}banNotes(){let i=this.$ban.$el.find("i");1==this.audio.muted?(this.audio.muted=!1,i.removeClass("icon-muted").addClass("icon-volume")):(this.audio.muted=!0,i.removeClass("icon-volume").addClass("icon-muted"))}}class Progress{constructor(i,t){$.extend(this,t),this.$el=$(i),this.width=this.$el.width(),this.init()}init(){this.renderBackAndPointer(),this.drag(),this.value,this.changeDOMStyle(this.width*this.value)}renderBackAndPointer(){this.$back=$('<div class="back">'),this.$pointer=$('<div class="pointer">'),this.$el.append(this.$back),this.$el.append(this.$pointer)}setValue(i){let t=this.width*i/(this.max-this.min);this.changeDOMStyle(t)}drag(){let i=this.$pointer,t=this.$el,s=!1;i.mousedown((e=>{s=!0;let n=e.offsetX;$(document).mousemove((e=>{if(!0===s){let s=e.clientX-t.offset().left-n,o=Math.max(0,Math.min(s,t.outerWidth(!1)-i.outerWidth(!1))),a=o/t.outerWidth(!1)*(this.max-this.min);this.changeDOMStyle(o),this.handler(a)}}))})),$(document).mouseup((()=>{s=!1}))}bindEvents(){this.$el.click((i=>{let t=i.offsetX,s=t/this.width*(this.max-this.min);this.changeDOMStyle(t),this.handler(s)}))}changeDOMStyle(i){this.$back.width(i+7==7?0:i+7),this.$pointer.css("left",i+"px")}}class Btns{constructor(i,t){this.$el=$(i),this.bindEvents(t)}bindEvents(i){for(const t in i)i.hasOwnProperty(t)&&this.$el.on(t,i[t])}}new Player;